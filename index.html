<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>École Ohr Joseph — Espace personnel</title>
  <meta name="description" content="Connexion professeur/personnel et création de compte pour le site de l’École Ohr Joseph." />
  <style>
    :root{
      --bg:#0b1220;         /* fond sombre lisible */
      --panel:#0f172a;      /* cartes */
      --panel-2:#111827;
      --text:#e5e7eb;       /* texte principal */
      --muted:#9ca3af;      /* texte secondaire */
      --accent:#fbbf24;     /* jaune des boutons */
      --accent-2:#22d3ee;   /* azur pour liens */
      --border:#1f2937;     /* bordures discrètes */
      --danger:#ef4444;     /* rouge erreurs */
      --success:#22c55e;    /* vert succès */
      --radius:16px;
      --shadow:0 6px 22px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:linear-gradient(180deg,#0b1220 0%,#0e1630 100%);
      color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    header{
      position:sticky;top:0;z-index:10;
      background:linear-gradient(90deg,#124e66,#1aa3a3);
      padding:14px 18px;box-shadow:var(--shadow);
    }
    .bar{max-width:1100px;margin:auto;display:flex;align-items:center;gap:18px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand img{width:32px;height:32px;border-radius:8px}
    nav{margin-left:auto;display:flex;gap:14px;flex-wrap:wrap}
    nav a{color:#002b36;background:rgba(255,255,255,.9);text-decoration:none;padding:8px 12px;border-radius:999px;font-weight:600}
    nav a:hover{background:#fff}

    main{max-width:1100px;margin:28px auto;padding:0 16px}
    .hero{margin:6px 0 22px}
    .hero h1{font-size:clamp(26px,2.8vw,36px);margin:.2rem 0 .4rem}
    .hero p{color:var(--muted);margin:0}

    .grid{
      display:grid;gap:18px;
      grid-template-columns:repeat(12,1fr);
    }
    .card{
      grid-column:span 12;
      background:linear-gradient(180deg,var(--panel),var(--panel-2));
      border:1px solid var(--border);border-radius:var(--radius);
      box-shadow:var(--shadow);padding:18px;
    }
    @media (min-width:900px){
      .card{grid-column:span 6}
    }
    .card h2{margin:.2rem 0 1rem}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    label{display:block;font-size:.95rem;margin:.2rem 0 .35rem}
    input,select{
      width:100%;padding:.8rem 1rem;border-radius:12px;
      border:1px solid var(--border);background:#0b1220;color:var(--text);
      outline:none;
    }
    input:focus,select:focus{border-color:#38bdf8;box-shadow:0 0 0 3px rgba(56,189,248,.2)}
    .two{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
      padding:.9rem 1.1rem;border-radius:14px;border:1px solid #8b5d00;
      background:linear-gradient(180deg,#fbbf24,#f59e0b);color:#19202a;
      font-weight:700;cursor:pointer;width:100%;
    }
    .btn[disabled]{opacity:.6;cursor:not-allowed;filter:grayscale(20%)}
    .msg{margin-top:.75rem;font-size:.95rem}
    .msg.ok{color:var(--success)}
    .msg.err{color:var(--danger)}
    footer{max-width:1100px;margin:28px auto;padding:0 16px;color:var(--muted);text-align:center}
    .link{color:var(--accent-2);text-decoration:none}
    .link:hover{text-decoration:underline}
    .small{font-size:.92rem;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="brand">
        <img src="https://dummyimage.com/64x64/ffffff/000000&text=OJ" alt="Ohr Joseph">
        <span>École Ohr Joseph</span>
      </div>
      <nav>
        <a href="/">Accueil</a>
        <a href="/admin.html">Administration</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <h1>Excellence & Tradition</h1>
      <p>Connexion du personnel et des professeurs. La création de compte nécessite la validation d’un administrateur.</p>
    </section>

    <div class="grid">
      <!-- Connexion -->
      <article class="card" id="loginCard">
        <h2>Connexion professeur / personnel</h2>
        <div class="row two">
          <div style="width:100%">
            <label for="loginEmail">E-mail</label>
            <input id="loginEmail" type="email" inputmode="email" autocomplete="email" required />
          </div>
          <div style="width:100%">
            <label for="loginPass">Mot de passe</label>
            <input id="loginPass" type="password" autocomplete="current-password" required />
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <button id="loginBtn" class="btn">Se connecter</button>
        </div>
        <div id="loginMsg" class="msg small"> </div>
      </article>

      <!-- Création -->
      <article class="card" id="registerCard">
        <h2>Créer un compte (validation admin requise)</h2>

        <div class="row two">
          <div><label for="rName">Nom</label><input id="rName" required /></div>
          <div><label for="rSurname">Prénom</label><input id="rSurname" required /></div>
        </div>

        <div class="row two" style="margin-top:12px">
          <div>
            <label for="rRole">Rôle</label>
            <select id="rRole" required>
              <option value="personnel">Personnel</option>
              <option value="prof">Professeur</option>
            </select>
          </div>
          <div>
            <label for="rClasse">Classe (si prof)</label>
            <input id="rClasse" placeholder="ex : 6e A" />
          </div>
        </div>

        <div class="row two" style="margin-top:12px">
          <div><label for="rEmail">E-mail</label><input id="rEmail" type="email" inputmode="email" autocomplete="email" required /></div>
          <div><label for="rPass">Mot de passe</label><input id="rPass" type="password" autocomplete="new-password" required /></div>
        </div>

        <div class="row" style="margin-top:12px">
          <button id="registerBtn" class="btn">Demander la création</button>
        </div>
        <div id="registerMsg" class="msg small"> </div>
      </article>
    </div>
  </main>

  <footer>
    <p>© 2025 École Ohr Joseph — <a class="link" href="/admin.html">Espace Administration</a></p>
  </footer>
<script type="module">
  // Endpoints (garde-les si tes routes sont identiques)
  const LOGIN_URL    = '/auth/login';
  const REGISTER_URL = '/auth/register';

  function show(el, msg, ok=false){
    el.textContent = msg;
    el.className = 'msg small ' + (ok ? 'ok' : 'err');
  }
  async function postJSON(url, data){
    const res = await fetch(url, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(data)
    });
    let json = null;
    try { json = await res.json(); } catch(e){}
    return { ok: res.ok, status: res.status, data: json };
  }

  // --- Connexion ---
  const loginBtn = document.getElementById('loginBtn');
  const loginMsg = document.getElementById('loginMsg');
  loginBtn.addEventListener('click', async () => {
    const email = document.getElementById('loginEmail').value.trim();
    const password  = document.getElementById('loginPass').value; // <-- password
    if(!email || !password){ show(loginMsg,'Veuillez remplir les champs.'); return; }
    loginBtn.disabled = true; show(loginMsg,'Connexion en cours…');

    // IMPORTANT: le serveur attend { email, password }
    const res = await postJSON(LOGIN_URL, { email, password });
    loginBtn.disabled = false;

    if(res.ok){
      show(loginMsg, res?.data?.message || 'Connecté !', true);
      setTimeout(()=> location.href='/admin.html', 600);
    } else {
      const msg = res?.data?.error || res?.data?.message || `Erreur ${res.status}`;
      show(loginMsg, msg);
    }
  });

  // --- Création de compte ---
  const registerBtn = document.getElementById('registerBtn');
  const registerMsg = document.getElementById('registerMsg');
  registerBtn.addEventListener('click', async () => {
    const payload = {
      name:    document.getElementById('rName').value.trim(),
      surname: document.getElementById('rSurname').value.trim(),
      role:    document.getElementById('rRole').value,
      classe:  document.getElementById('rClasse').value.trim(),
      email:   document.getElementById('rEmail').value.trim(),
      password:document.getElementById('rPass').value        // <-- password
    };
    if(!payload.name || !payload.surname || !payload.email || !payload.password){
      show(registerMsg,'Veuillez compléter tous les champs requis.'); return;
    }
    registerBtn.disabled = true; show(registerMsg,'Envoi de la demande…');

    // IMPORTANT: le serveur attend { name, surname, role, classe, email, password }
    const res = await postJSON(REGISTER_URL, payload);
    registerBtn.disabled = false;

    if(res.ok){
      show(registerMsg, res?.data?.message || 'Demande envoyée. Vérifiez vos e-mails.', true);
    } else {
      const msg = res?.data?.error || res?.data?.message || `Erreur ${res.status}`;
      show(registerMsg, msg);
    }
  });

  // Accessibilité: Enter pour valider
  for (const id of ['loginEmail','loginPass']) {
    document.getElementById(id).addEventListener('keydown', (e)=>{
      if(e.key==='Enter') loginBtn.click();
    });
  }
  for (const id of ['rName','rSurname','rClasse','rEmail','rPass']) {
    const el = document.getElementById(id);
    el && el.addEventListener('keydown',(e)=>{ if(e.key==='Enter') registerBtn.click(); });
  }
</script>

</body>
</html>
